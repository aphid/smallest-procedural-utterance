<!doctype html>
<html>

<head>
<<<<<<< HEAD
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/font-hack/2.015/css/hack.min.css">

  <script src="lib/socket.io-1.3.7.js"></script>
  <style>
    body {
      font-family: Hack, monospace;
    }
    
    #c3 {
      image-rendering: -moz-crisp-edges;
      image-rendering: -o-crisp-edges;
      image-rendering: pixelated;
      image-rendering: crisp-edges;
    }
  </style>
  <title>smallest procedural utterance</title>
</head>

<body>
  <video id="video" width="640" height="360" autoplay crossorigin="Anonymous">
    <!-- <source src="./media/crap.webm" controls/> -->
    <source src="https://illegible.us/oversee/media/video/180509_0930.mp4" />
=======
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/font-hack/2.015/css/hack.min.css">
    <script src="lib/socket.io-1.3.7.js"></script>
    <style>
    </style>
    <title>smallest procedural utterance</title>
</head>

<body>
    <video id="video" width="640" height="360" autoplay crossorigin>
    <source src="https://illegible.us/ssci/media/video/170112_1000.mp4"  />
>>>>>>> 4cb62c644c41aa352d2849d94ccccd9dadd72542
  </video>

    <canvas id="c1" width="640" height="360"></canvas>
    <canvas id="c2" width="640" height="360"></canvas>

<<<<<<< HEAD
  <section id="canvasholder">
    <canvas id="c3" width="640" height="360"></canvas>
    <div id="metadata">
    "video": {
        "localPath": "/var/www/illegible.us/html/oversee/media/video/180509_0930.mp4",
        "ogg": "",
        "url": "https://www.senate.gov/isvp/?type=arch&comm=intel&filename=intel050918&auto_play=false&poster=http://www.intelligence.senate.gov/sites/default/files/video-poster-flash-fit.jpg",
        "basename": "180509_0930",
        "type": "mp4",
        "metapath": "/var/www/illegible.us/html/oversee/media/video/180509_0930.json"
      },
      "witnesses": [
        {
          "firstName": "Gina",
          "lastName": "Haspel",
          "title": "Deputy Director",
          "id": "/field-collection/field-hearing-witness/329",
          "org": "CIA",
          "pdfs": [
            {
              "remoteUrl": "http://www.intelligence.senate.gov/sites/default/files/documents/os-ghaspel-050918.pdf",
              "remotefileName": "os-ghaspel-050918.pdf",
              "localName": "180509_0930_os-ghaspel-050918.pdf",
              "title": "Opening Statement",
              "localPath": "/var/www/illegible.us/html/oversee/media/text/180509_0930_os-ghaspel-050918.pdf",
              "metadata": {
                "exiftoolVersionNumber": 10.8,
                "fileName": "180509_0930_os-ghaspel-050918.pdf",
                "directory": "/var/www/illegible.us/html/oversee/media/text",
                "fileSize": "214 kB",
                "fileModificationDate/Time": "2018:05:11 02:21:24+00:00",
                "fileAccessDate/Time": "2018:05:11 02:21:24+00:00",
                "fileInodeChangeDate/Time": "2018:05:11 02:21:24+00:00",
                "filePermissions": "rw-rw-r--",
                "fileType": "PDF",
                "fileTypeExtension": "pdf",
                "mimeType": "application/pdf",
                "pdfVersion": 1.5,
                "linearized": "No",
                "pageCount": 4,
                "language": "en-US",
                "taggedPDF": "Yes",
                "createDate": "2018:05:08 11:01:30-04:00",
                "modifyDate": "2018:05:08 11:01:30-04:00"
              },
              "txtpath": "/var/www/illegible.us/html/oversee/media/text/180509_0930_os-ghaspel-050918.pdf.txt",
              "needsScan": true,
              "imgdir": "/var/www/illegible.us/html/oversee/media/text/180509_0930_os-ghaspel-050918"
            },
            {
              "remoteUrl": "http://www.intelligence.senate.gov/sites/default/files/documents/q-ghaspel-050918.pdf",
              "remotefileName": "q-ghaspel-050918.pdf",
              "localName": "180509_0930_q-ghaspel-050918.pdf",
              "title": "Response to Questionnaire for Completion by Presidential Nominees",
              "localPath": "/var/www/illegible.us/html/oversee/media/text/180509_0930_q-ghaspel-050918.pdf",
              "metadata": {
                "exiftoolVersionNumber": 10.8,
                "fileName": "180509_0930_q-ghaspel-050918.pdf",
                "directory": "/var/www/illegible.us/html/oversee/media/text",
                "fileSize": "478 kB",
                "fileModificationDate/Time": "2018:05:11 02:21:50+00:00",
                "fileAccessDate/Time": "2018:05:11 02:21:50+00:00",
                "fileInodeChangeDate/Time": "2018:05:11 02:21:50+00:00",
                "filePermissions": "rw-rw-r--",
                "fileType": "PDF",
                "fileTypeExtension": "pdf",
                "mimeType": "application/pdf",
                "pdfVersion": 1.4,
                "linearized": "Yes",
                "createDate": "2018:05:08 13:02:13-04:00",
                "creator": "Hewlett-Packard MFP",
                "modifyDate": "2018:05:08 13:02:13-04:00",
                "xmpToolkit": "Adobe XMP Core 5.4-c006 80.159825, 2016/09/16-03:31:08",
                "format": "application/pdf",
                "creatorTool": "Hewlett-Packard MFP",
                "metadataDate": "2018:05:08 13:02:13-04:00",
                "documentID": "uuid:fda078b4-1a1b-4ca7-8384-d53764627430",
                "instanceID": "uuid:474ad287-064d-4004-bb94-940c3dfbad1e",
                "pageCount": 13
              },
              "txtpath": "/var/www/illegible.us/html/oversee/media/text/180509_0930_q-ghaspel-050918.pdf.txt",
              "needsScan": true,
              "imgdir": "/var/www/illegible.us/html/oversee/media/text/180509_0930_q-ghaspel-050918"
            },
            {
              "remoteUrl": "http://www.intelligence.senate.gov/sites/default/files/documents/aphq-ghaspel-050918.pdf",
              "remotefileName": "aphq-ghaspel-050918.pdf",
              "localName": "180509_0930_aphq-ghaspel-050918.pdf",
              "title": "Response to Committee Additional Pre-Hearing Questions",
              "localPath": "/var/www/illegible.us/html/oversee/media/text/180509_0930_aphq-ghaspel-050918.pdf",
              "metadata": {
                "exiftoolVersionNumber": 10.8,
                "fileName": "180509_0930_aphq-ghaspel-050918.pdf",
                "directory": "/var/www/illegible.us/html/oversee/media/text",
                "fileSize": "181 kB",
                "fileModificationDate/Time": "2018:05:11 02:22:24+00:00",
                "fileAccessDate/Time": "2018:05:11 02:22:24+00:00",
                "fileInodeChangeDate/Time": "2018:05:11 02:22:24+00:00",
                "filePermissions": "rw-rw-r--",
                "fileType": "PDF",
                "fileTypeExtension": "pdf",
                "mimeType": "application/pdf",
                "pdfVersion": 1.5,
                "linearized": "Yes",
                "aacgAddMark": null,
                "aacgClassBlock": null,
                "aacgClassType": "USClassificationMarking",
                "aacgCreated": 1,
                "aacgCustomClassXMLPart": "{6AAC734C-9148-4516-B2F3-9BB3C383152E}",
                "aacgDeclOnList": null,
                "aacgDescMarkings": null,
                "aacgDissemOther": null,
                "aacgFooter": ".UNCLASSIFIED",
                "aacgHeader": "UNCLASSIFIED",
                "aacgNatoWarningClassLevel": null,
                "aacgNonIntOther": null,
                "aacgOFFICEDLL": 1,
                "aacgOrconOriginator": null,
                "aacgOrconRecipients": null,
                "aacgSCIOther": null,
                "aacgSatWarningType": null,
                "aacgUSAFDerivatives": null,
                "author": "ROBERTAM",
                "comments": null,
                "company": "U.S. Government",
                "createDate": "2018:05:05 21:20:06-04:00",
                "modifyDate": "2018:05:05 21:20:18-04:00",
                "portionWaiver": null,
                "sourceModified": "D:20180506011924",
                "subject": null,
                "language": "EN-US",
                "taggedPDF": "Yes",
                "xmpToolkit": "Adobe XMP Core 5.4-c006 80.159825, 2016/09/16-03:31:08",
                "metadataDate": "2018:05:05 21:20:18-04:00",
                "creatorTool": "Acrobat PDFMaker 11 for Word",
                "documentID": "uuid:fefdf892-8dcf-4200-8bdd-47964e423ddd",
                "instanceID": "uuid:55d004af-668f-4c2c-bb60-608b628ff0b9",
                "format": "application/pdf",
                "title": null,
                "description": null,
                "creator": "ROBERTAM",
                "producer": "Adobe PDF Library 11.0",
                "keywords": null,
                "aacgOfficeDll": 1,
                "pageLayout": "OneColumn",
                "pageCount": 65
              },
              "txtpath": "/var/www/illegible.us/html/oversee/media/text/180509_0930_aphq-ghaspel-050918.pdf.txt",
              "needsScan": true,
              "imgdir": "/var/www/illegible.us/html/oversee/media/text/180509_0930_aphq-ghaspel-050918"
            }
          ]
        }
      ],
      "dcDate": "2018-05-09T09:30:00-04:00",
      "hearingPage": "http://www.intelligence.senate.gov/hearings/open-hearing-nomination-gina-haspel-be-director-central-intelligence-agency",
      "title": "Open Hearing:  Nomination of Gina Haspel to be the Director of the Central Intelligence Agency",
      "date": "05/09/2018",
      "time": "9:30am",
      "parseDate": "05/09/2018 09:30",
      "shortdate": "180509",
      "shorttime": "0930",
      "shortname": "180509_0930"
    }
    
    </div>
    <div id="durbar">
      <div id="cur" class="loc"></div>
    </div>
=======
    <section id="canvasholder">
        <canvas id="c3" width="640" height="360"></canvas>
        <div id="metadata">{ "video": { "localPath": "/media/video/130312.flv", "mp4": "", "ogg": "", "url": "http://www.senate.gov/isvp/?type=arch&amp;comm=intel&amp;filename=intel031213&amp;auto_play=false&amp;poster=http://www.intelligence.senate.gov/sites/default/files/video-poster-flash-fit.jpg", "basename": "130312", "type": "hds", "etpath": "./media/metadata/130312.exiftool.json" }, "witnesses": [ { "pdfs": [ { "remoteUrl": "http://www.intelligence.senate.gov/sites/default/files/hearings/clapper%20%283%29.pdf", "remotefileName": "clapper (3).pdf", "localName": "130312_clapper(3).pdf", "localPath": "./media/text/130312_clapper(3).pdf" } ], "firstName": "James R.", "lastName": "Clapper" } ], "dcDate": "2013-03-12T10:00:00-04:00", "hearingPage": "http://www.intelligence.senate.gov/hearings/open-hearing-current-and-projected-national-security-threats-united-states-1", "title": "Open Hearing: Current and Projected National Security Threats to the United States", "date": "03/12/2013", "time": "10:00am", "shortdate": "130312" }
        </div>
        <div id="durbar">
            <div id="cur" class="loc"></div>
        </div>
>>>>>>> 4cb62c644c41aa352d2849d94ccccd9dadd72542

        <section id="moments"></section>

        <div id="meter"></div>
        <span id="pos"></span>


    </section>
</body>

<<<<<<< HEAD
<script>
  var delay = 50;
  var comp = {};
  comp.transitions = [];

  comp.reportFrame = function (time) {
    var self = this;
    var num = document.createElement('span');
    num.textContent = time + " ";
    document.querySelector('#moments').appendChild(num);
    comp.transitions.push(time);
    this.addMark(time);
    /*
    this.socket.emit('intel', {
      'type': 'shot',
      'hearing': this.hearing,
      'boundary': time
    });*/

  };


  comp.setup = function () {

    var self = this;
    this.hearing = 'intel20130312';
    this.roughThreshold = 100;
    this.roughInterval = 60.3;
    this.fineThreshold = 90;
    this.fineInterval = 2.31;
    this.ultraThreshold = 65;
    this.ultraInterval = 0.304
    this.video = document.getElementById('video');
    this.c1 = document.getElementById('c1');
    this.ctx1 = this.c1.getContext('2d');
    this.c2 = document.getElementById('c2');
    this.ctx2 = this.c2.getContext('2d');
    this.c3 = document.getElementById('c3');
    this.ctx3 = this.c3.getContext('2d');

    this.socket = io.connect("https://localhost:3000");
    this.socket.emit('subscribe', {
      hearing: this.hearing,
      name: 'shot'
    });
    this.mode = "rough";
    this.cur = document.querySelector("#cur");
    this.video.addEventListener("canplay", function () {
      console.log('asdfg');
      this.pause();
      self.width = self.video.videoWidth;
      self.height = self.video.videoHeight;
      this.removeEventListener("canplay", arguments.callee);

      self.advance();
    }, false);

    this.video.addEventListener("error", function (error) {
      console.log("UH OH");
      console.log(error);
      console.log(error.target.error);
      video.load();
      comp.advance();
    }, true);


  };

  comp.advance = function () {
    if (this.stop) {
      return false;
    }
    var interval;
    if (this.mode === "rough") {
      interval = this.roughInterval;
      threshold = this.roughThreshold;
      delay = 50;
    } else if (this.mode === "fine") {
      interval = this.fineInterval;
      threshold = this.fineThreshold;
      delay = 350;
    } else if (this.mode === "ultra") {
      interval = this.ultraInterval;
      threshold = this.ultraThreshold;
      delay = 525;
    }
    var self = this;
    try {
      this.ctx1.drawImage(this.video, 0, 0, this.width, this.height);
    } catch (e) {
      if (e.name == "NS_ERROR_NOT_AVAILABLE") {
        // Wait a bit before trying again; you may wish to change the
        // length of this delay.
        setTimeout(comp.advance, 100);
      } else {
        throw e;
      }
    }
    this.video.addEventListener('seeked', function () {
      self.video.removeEventListener('seeked', arguments.callee);

      var pct = (self.video.currentTime / self.video.duration * 100) + "%";
      self.cur.style.left = pct;


      self.ctx2.drawImage(self.video, 0, 0, self.width, self.height);

      self.ctx3.globalCompositeOperation = "source-over";
      self.ctx3.drawImage(self.c1, 0, 0, self.width, self.height);
      self.ctx3.globalCompositeOperation = "difference";
      self.ctx3.drawImage(self.c2, 0, 0, self.width, self.height);

      var pixels = self.ctx3.getImageData(0, 0, self.width, self.height);


      var br = 0;
      for (var i = 0, n = pixels.data.length; i < n; i += 4) {
        var red = pixels.data[i];
        var green = pixels.data[i + 1];
        var blue = pixels.data[i + 2];
        br = br + red + green + blue;
      }
      var thresh = (br / (self.width * self.height)).toFixed(4);
      var meter = document.querySelector('#meter');
      var metadata = document.querySelector('#metadata');
      metadata.addEventListener("transitionend", function(event) {
  metadata.style.display = "none";
}, false);

      meter.textContent = self.video.currentTime + " " + thresh;
      if (thresh > threshold) {

        if (self.mode === "rough") {
          console.log(thresh);
          console.log('threshold passed ' + threshold + ', moving to fine at ' + self.video.currentTime);
          self.mode = "fine";
          metadata.style.opacity = '0';
          self.video.currentTime = self.video.currentTime - interval;

        } else if (self.mode === "fine") {
          console.log('threshold passed ' + threshold + ', moving to ultra at ' + self.video.currentTime);

          self.mode = "ultra";
          self.video.currentTime = self.video.currentTime - interval;
        } else {
          console.log('threshold passed ' + threshold + ', recording transition at ' + self.video.currentTime);
          delay = 10000;
          comp.reportFrame(self.video.currentTime);

          self.mode = "fine";
          meter.classList.add('hit');
        }
      } else {
        meter.classList.remove('hit');
      }
      window.setTimeout(function () {

        comp.advance();
      }, delay);
    }, false);
    this.video.currentTime = (this.video.currentTime + interval).toFixed(4);

  };

  comp.addMark = function (seconds) {
    console.log('adding ' + seconds);
    var add = document.createElement('div');
    add.id = 'loc' + seconds;
    add.classList.add('loc');

    document.querySelector('#durbar').appendChild(add);
    var pct = (seconds / this.video.duration * 100) + "%";
    console.log(seconds + " " + this.video.duration + " " + pct);
    add.style.left = pct;
  };

  function secondsToSMPTE(seconds, framerate) {
    var f = Math.floor((seconds % 1) * framerate);
    var s = Math.floor(seconds);
    var m = Math.floor(s / 60);
    var h = Math.floor(m / 60);
    m = m % 60;
    s = s % 60;

    return h + ":" + m + ":" + s + "." + f;
  }

  document.querySelector('video').addEventListener('loadedmetadata', function () {
    for (var i = 0; i < document.querySelectorAll('canvas').length; i++) {
      var canvas = document.querySelectorAll('canvas')[i];

      canvas.style.width = document.querySelector('video').videoWidth;
      canvas.style.height = document.querySelector('video').videoHeight;
    }
    comp.setup();
  });
=======
<script src="spu.js">
>>>>>>> 4cb62c644c41aa352d2849d94ccccd9dadd72542
</script>
